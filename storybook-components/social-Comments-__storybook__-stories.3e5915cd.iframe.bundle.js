"use strict";(self.webpackChunk_baseapp_frontend_components=self.webpackChunk_baseapp_frontend_components||[]).push([[278],{"./__generated__/CommentsFragment.graphql.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var node={argumentDefinitions:[{defaultValue:!0,kind:"LocalArgument",name:"isCommentsOpened"}],kind:"Fragment",metadata:{refetch:{connection:null,fragmentPathInResult:["node"],operation:__webpack_require__("./__generated__/CommentsRefetchQuery.graphql.ts"),identifierInfo:{identifierField:"id",identifierQueryVariableName:"id"}}},name:"CommentsFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isCommentsEnabled",storageKey:null},{alias:null,args:null,concreteType:"CommentsCount",kind:"LinkedField",name:"commentsCount",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"total",storageKey:null}],storageKey:null},{condition:"isCommentsOpened",kind:"Condition",passingValue:!0,selections:[{args:null,kind:"FragmentSpread",name:"CommentsList_comments"}]},{args:null,kind:"FragmentSpread",name:"CommentItem_target"}],type:"CommentsInterface",abstractKey:"__isCommentsInterface",hash:"5c6447c09e41ab2fcd66157fb900571a"};const __WEBPACK_DEFAULT_EXPORT__=node},"./__generated__/CommentsRefetchQuery.graphql.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var v0,v1,v2,v3,v4,v5,v6,v7,v8,node={fragment:{argumentDefinitions:[v0={defaultValue:null,kind:"LocalArgument",name:"id"},v1={defaultValue:!0,kind:"LocalArgument",name:"isCommentsOpened"}],kind:"Fragment",metadata:null,name:"CommentsRefetchQuery",selections:[{alias:null,args:v2=[{kind:"Variable",name:"id",variableName:"id"}],concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[{args:[{kind:"Variable",name:"isCommentsOpened",variableName:"isCommentsOpened"}],kind:"FragmentSpread",name:"CommentsFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[v1,v0],kind:"Operation",name:"CommentsRefetchQuery",selections:[{alias:null,args:v2,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[v3={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},v4={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"isCommentsEnabled",storageKey:null},v6={alias:null,args:null,concreteType:"CommentsCount",kind:"LinkedField",name:"commentsCount",plural:!1,selections:v5=[{alias:null,args:null,kind:"ScalarField",name:"total",storageKey:null}],storageKey:null},{condition:"isCommentsOpened",kind:"Condition",passingValue:!0,selections:[{alias:null,args:v7=[{kind:"Literal",name:"first",value:5},{kind:"Literal",name:"orderBy",value:"-is_pinned,-created"}],concreteType:"CommentConnection",kind:"LinkedField",name:"comments",plural:!1,selections:[{alias:null,args:null,concreteType:"PageInfo",kind:"LinkedField",name:"pageInfo",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"endCursor",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"hasNextPage",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"CommentEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Comment",kind:"LinkedField",name:"node",plural:!1,selections:[v4,{alias:null,args:null,kind:"ScalarField",name:"isPinned",storageKey:null},v8={alias:null,args:null,kind:"ScalarField",name:"pk",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"body",storageKey:null},{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[v4,v8,{alias:null,args:null,kind:"ScalarField",name:"fullName",storageKey:null},{alias:null,args:[{kind:"Literal",name:"height",value:50},{kind:"Literal",name:"width",value:50}],concreteType:"File",kind:"LinkedField",name:"avatar",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],storageKey:"avatar(height:50,width:50)"}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created",storageKey:null},v6,{alias:"canChange",args:[{kind:"Literal",name:"perm",value:"change"}],kind:"ScalarField",name:"hasPerm",storageKey:'hasPerm(perm:"change")'},{alias:"canDelete",args:[{kind:"Literal",name:"perm",value:"delete"}],kind:"ScalarField",name:"hasPerm",storageKey:'hasPerm(perm:"delete")'},{alias:"canReport",args:[{kind:"Literal",name:"perm",value:"report"}],kind:"ScalarField",name:"hasPerm",storageKey:'hasPerm(perm:"report")'},{alias:"canPin",args:[{kind:"Literal",name:"perm",value:"pin"}],kind:"ScalarField",name:"hasPerm",storageKey:'hasPerm(perm:"pin")'},v3,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"ReactionsCount",kind:"LinkedField",name:"reactionsCount",plural:!1,selections:v5,storageKey:null},{alias:null,args:null,concreteType:"Reaction",kind:"LinkedField",name:"myReaction",plural:!1,selections:[v4,{alias:null,args:null,kind:"ScalarField",name:"reactionType",storageKey:null}],storageKey:null}],type:"ReactionsInterface",abstractKey:"__isReactionsInterface"},{kind:"TypeDiscriminator",abstractKey:"__isCommentsInterface"}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cursor",storageKey:null}],storageKey:null}],storageKey:'comments(first:5,orderBy:"-is_pinned,-created")'},{alias:null,args:v7,filters:[],handle:"connection",key:"CommentsList_comments",kind:"LinkedHandle",name:"comments"}]}],type:"CommentsInterface",abstractKey:"__isCommentsInterface"}],storageKey:null}]},params:{cacheID:"29c62fd9e62f6ecb8ffe052163e053c6",id:null,metadata:{},name:"CommentsRefetchQuery",operationKind:"query",text:'query CommentsRefetchQuery(\n  $isCommentsOpened: Boolean = true\n  $id: ID!\n) {\n  node(id: $id) {\n    __typename\n    ...CommentsFragment_2iZoM\n    id\n  }\n}\n\nfragment CommentItem_comment on Comment {\n  id\n  pk\n  body\n  isPinned\n  user {\n    id\n    pk\n    fullName\n    avatar(width: 50, height: 50) {\n      url\n    }\n  }\n  created\n  commentsCount {\n    total\n  }\n  canChange: hasPerm(perm: "change")\n  canDelete: hasPerm(perm: "delete")\n  canReport: hasPerm(perm: "report")\n  canPin: hasPerm(perm: "pin")\n  ...ReactionButton_target\n  ...CommentItem_target\n}\n\nfragment CommentItem_target on CommentsInterface {\n  __isCommentsInterface: __typename\n  id\n}\n\nfragment CommentsFragment_2iZoM on CommentsInterface {\n  __isCommentsInterface: __typename\n  id\n  __typename\n  isCommentsEnabled\n  commentsCount {\n    total\n  }\n  ...CommentsList_comments @include(if: $isCommentsOpened)\n  ...CommentItem_target\n}\n\nfragment CommentsList_comments on CommentsInterface {\n  __isCommentsInterface: __typename\n  id\n  commentsCount {\n    total\n  }\n  comments(first: 5, orderBy: "-is_pinned,-created") {\n    pageInfo {\n      endCursor\n      hasNextPage\n    }\n    edges {\n      node {\n        id\n        isPinned\n        ...CommentItem_comment\n        __typename\n      }\n      cursor\n    }\n  }\n  ...CommentItem_target\n}\n\nfragment ReactionButton_target on ReactionsInterface {\n  __isReactionsInterface: __typename\n  id\n  reactionsCount {\n    total\n  }\n  myReaction {\n    id\n    reactionType\n  }\n}\n'}};node.hash="5c6447c09e41ab2fcd66157fb900571a";const __WEBPACK_DEFAULT_EXPORT__=node},"./__generated__/CommentsWithQuery.graphql.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var v0,v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,node={fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"CommentsWithQuery",selections:[{alias:"target",args:v0=[{kind:"Literal",name:"id",value:"test-id"}],concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"CommentsFragment"}],storageKey:'node(id:"test-id")'}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"CommentsWithQuery",selections:[{alias:"target",args:v0,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[v1={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},v2={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"isCommentsEnabled",storageKey:null},v4={alias:null,args:null,concreteType:"CommentsCount",kind:"LinkedField",name:"commentsCount",plural:!1,selections:v3=[{alias:null,args:null,kind:"ScalarField",name:"total",storageKey:null}],storageKey:null},{alias:null,args:v5=[{kind:"Literal",name:"first",value:5},{kind:"Literal",name:"orderBy",value:"-is_pinned,-created"}],concreteType:"CommentConnection",kind:"LinkedField",name:"comments",plural:!1,selections:[{alias:null,args:null,concreteType:"PageInfo",kind:"LinkedField",name:"pageInfo",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"endCursor",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"hasNextPage",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"CommentEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Comment",kind:"LinkedField",name:"node",plural:!1,selections:[v2,{alias:null,args:null,kind:"ScalarField",name:"isPinned",storageKey:null},v6={alias:null,args:null,kind:"ScalarField",name:"pk",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"body",storageKey:null},{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[v2,v6,{alias:null,args:null,kind:"ScalarField",name:"fullName",storageKey:null},{alias:null,args:[{kind:"Literal",name:"height",value:50},{kind:"Literal",name:"width",value:50}],concreteType:"File",kind:"LinkedField",name:"avatar",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],storageKey:"avatar(height:50,width:50)"}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created",storageKey:null},v4,{alias:"canChange",args:[{kind:"Literal",name:"perm",value:"change"}],kind:"ScalarField",name:"hasPerm",storageKey:'hasPerm(perm:"change")'},{alias:"canDelete",args:[{kind:"Literal",name:"perm",value:"delete"}],kind:"ScalarField",name:"hasPerm",storageKey:'hasPerm(perm:"delete")'},{alias:"canReport",args:[{kind:"Literal",name:"perm",value:"report"}],kind:"ScalarField",name:"hasPerm",storageKey:'hasPerm(perm:"report")'},{alias:"canPin",args:[{kind:"Literal",name:"perm",value:"pin"}],kind:"ScalarField",name:"hasPerm",storageKey:'hasPerm(perm:"pin")'},v1,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"ReactionsCount",kind:"LinkedField",name:"reactionsCount",plural:!1,selections:v3,storageKey:null},{alias:null,args:null,concreteType:"Reaction",kind:"LinkedField",name:"myReaction",plural:!1,selections:[v2,{alias:null,args:null,kind:"ScalarField",name:"reactionType",storageKey:null}],storageKey:null}],type:"ReactionsInterface",abstractKey:"__isReactionsInterface"},{kind:"TypeDiscriminator",abstractKey:"__isCommentsInterface"}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cursor",storageKey:null}],storageKey:null}],storageKey:'comments(first:5,orderBy:"-is_pinned,-created")'},{alias:null,args:v5,filters:[],handle:"connection",key:"CommentsList_comments",kind:"LinkedHandle",name:"comments"}],type:"CommentsInterface",abstractKey:"__isCommentsInterface"}],storageKey:'node(id:"test-id")'}]},params:{cacheID:"9482acd41c824d468c0704483b67ac7c",id:null,metadata:{relayTestingSelectionTypeInfo:{target:{enumValues:null,nullable:!0,plural:!1,type:"Node"},"target.__isCommentsInterface":v7={enumValues:null,nullable:!1,plural:!1,type:"String"},"target.__typename":v7,"target.comments":{enumValues:null,nullable:!0,plural:!1,type:"CommentConnection"},"target.comments.edges":{enumValues:null,nullable:!1,plural:!0,type:"CommentEdge"},"target.comments.edges.cursor":v7,"target.comments.edges.node":{enumValues:null,nullable:!0,plural:!1,type:"Comment"},"target.comments.edges.node.__isCommentsInterface":v7,"target.comments.edges.node.__isReactionsInterface":v7,"target.comments.edges.node.__typename":v7,"target.comments.edges.node.body":v8={enumValues:null,nullable:!0,plural:!1,type:"String"},"target.comments.edges.node.canChange":v9={enumValues:null,nullable:!0,plural:!1,type:"Boolean"},"target.comments.edges.node.canDelete":v9,"target.comments.edges.node.canPin":v9,"target.comments.edges.node.canReport":v9,"target.comments.edges.node.commentsCount":v10={enumValues:null,nullable:!1,plural:!1,type:"CommentsCount"},"target.comments.edges.node.commentsCount.total":v11={enumValues:null,nullable:!0,plural:!1,type:"Int"},"target.comments.edges.node.created":{enumValues:null,nullable:!1,plural:!1,type:"DateTime"},"target.comments.edges.node.id":v12={enumValues:null,nullable:!1,plural:!1,type:"ID"},"target.comments.edges.node.isPinned":v13={enumValues:null,nullable:!1,plural:!1,type:"Boolean"},"target.comments.edges.node.myReaction":{enumValues:null,nullable:!0,plural:!1,type:"Reaction"},"target.comments.edges.node.myReaction.id":v12,"target.comments.edges.node.myReaction.reactionType":{enumValues:["LIKE","DISLIKE"],nullable:!0,plural:!1,type:"ReactionTypes"},"target.comments.edges.node.pk":v14={enumValues:null,nullable:!1,plural:!1,type:"Int"},"target.comments.edges.node.reactionsCount":{enumValues:null,nullable:!0,plural:!1,type:"ReactionsCount"},"target.comments.edges.node.reactionsCount.total":v11,"target.comments.edges.node.user":{enumValues:null,nullable:!0,plural:!1,type:"User"},"target.comments.edges.node.user.avatar":{enumValues:null,nullable:!0,plural:!1,type:"File"},"target.comments.edges.node.user.avatar.url":v7,"target.comments.edges.node.user.fullName":v8,"target.comments.edges.node.user.id":v12,"target.comments.edges.node.user.pk":v14,"target.comments.pageInfo":{enumValues:null,nullable:!1,plural:!1,type:"PageInfo"},"target.comments.pageInfo.endCursor":v8,"target.comments.pageInfo.hasNextPage":v13,"target.commentsCount":v10,"target.commentsCount.total":v11,"target.id":v12,"target.isCommentsEnabled":v13}},name:"CommentsWithQuery",operationKind:"query",text:'query CommentsWithQuery {\n  target: node(id: "test-id") {\n    __typename\n    ...CommentsFragment\n    id\n  }\n}\n\nfragment CommentItem_comment on Comment {\n  id\n  pk\n  body\n  isPinned\n  user {\n    id\n    pk\n    fullName\n    avatar(width: 50, height: 50) {\n      url\n    }\n  }\n  created\n  commentsCount {\n    total\n  }\n  canChange: hasPerm(perm: "change")\n  canDelete: hasPerm(perm: "delete")\n  canReport: hasPerm(perm: "report")\n  canPin: hasPerm(perm: "pin")\n  ...ReactionButton_target\n  ...CommentItem_target\n}\n\nfragment CommentItem_target on CommentsInterface {\n  __isCommentsInterface: __typename\n  id\n}\n\nfragment CommentsFragment on CommentsInterface {\n  __isCommentsInterface: __typename\n  id\n  __typename\n  isCommentsEnabled\n  commentsCount {\n    total\n  }\n  ...CommentsList_comments\n  ...CommentItem_target\n}\n\nfragment CommentsList_comments on CommentsInterface {\n  __isCommentsInterface: __typename\n  id\n  commentsCount {\n    total\n  }\n  comments(first: 5, orderBy: "-is_pinned,-created") {\n    pageInfo {\n      endCursor\n      hasNextPage\n    }\n    edges {\n      node {\n        id\n        isPinned\n        ...CommentItem_comment\n        __typename\n      }\n      cursor\n    }\n  }\n  ...CommentItem_target\n}\n\nfragment ReactionButton_target on ReactionsInterface {\n  __isReactionsInterface: __typename\n  id\n  reactionsCount {\n    total\n  }\n  myReaction {\n    id\n    reactionType\n  }\n}\n'}};node.hash="64b3a06f269b694de19ac7c4ca12ab26";const __WEBPACK_DEFAULT_EXPORT__=node},"./modules/social/Comments/__storybook__/stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DefaultComments:()=>DefaultComments,default:()=>stories});var _CommentsFragment,react_relay=__webpack_require__("../../node_modules/react-relay/index.js"),react=__webpack_require__("../../node_modules/react/index.js"),social_CommentCreate=__webpack_require__("./modules/social/CommentCreate/index.tsx"),social_CommentsList=__webpack_require__("./modules/social/CommentsList/index.tsx"),comments=__webpack_require__("./modules/social/context/comments/index.ts"),CommentsFragmentQuery=void 0!==_CommentsFragment?_CommentsFragment:_CommentsFragment=__webpack_require__("./__generated__/CommentsFragment.graphql.ts"),jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var Comments=function Comments(_ref){var targetRef=_ref.target,profileId=_ref.profileId,_ref$subscriptionsEna=_ref.subscriptionsEnabled,subscriptionsEnabled=void 0===_ref$subscriptionsEna||_ref$subscriptionsEna,_ref$CommentsList=_ref.CommentsList,CommentsList=void 0===_ref$CommentsList?social_CommentsList.A:_ref$CommentsList,CommentsListProps=_ref.CommentsListProps,_ref$CommentCreate=_ref.CommentCreate,CommentCreate=void 0===_ref$CommentCreate?social_CommentCreate.A:_ref$CommentCreate,CommentCreateProps=_ref.CommentCreateProps,onCommentCreateFocus=_ref.onCommentCreateFocus,resetCommentReply=(0,comments.lr)().resetCommentReply,commentCreateRef=(0,react.useRef)(null),target=(0,react_relay.useFragment)(CommentsFragmentQuery,targetRef),subscriptionsEnabledBoolean="boolean"!=typeof subscriptionsEnabled||subscriptionsEnabled;return(0,react.useEffect)((function(){return function(){resetCommentReply()}}),[]),target.isCommentsEnabled?(0,jsx_runtime.jsxs)("div",{className:"grid",children:[(0,jsx_runtime.jsx)(CommentsList,_objectSpread({target,profileId,subscriptionsEnabled:subscriptionsEnabledBoolean,onReplyClick:function handleCommentCreateFocus(){commentCreateRef.current&&(commentCreateRef.current.focus({preventScroll:!0}),null==onCommentCreateFocus||onCommentCreateFocus(commentCreateRef.current))}},CommentsListProps)),(0,jsx_runtime.jsx)(CommentCreate,_objectSpread({ref:commentCreateRef,targetObjectId:target.id,profileId},CommentCreateProps))]}):null};const social_Comments=(0,comments.lD)(Comments);var _CommentsWithQuery;function CommentsWithQuery_typeof(o){return CommentsWithQuery_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},CommentsWithQuery_typeof(o)}function CommentsWithQuery_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function CommentsWithQuery_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?CommentsWithQuery_ownKeys(Object(t),!0).forEach((function(r){CommentsWithQuery_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):CommentsWithQuery_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function CommentsWithQuery_defineProperty(e,r,t){return(r=function CommentsWithQuery_toPropertyKey(t){var i=function CommentsWithQuery_toPrimitive(t,r){if("object"!=CommentsWithQuery_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=CommentsWithQuery_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==CommentsWithQuery_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}Comments.__docgenInfo={description:"",methods:[],displayName:"Comments",props:{target:{required:!0,tsType:{name:"signature",type:"object",raw:"{\n  readonly ' $data'?: CommentsFragment$data\n  readonly ' $fragmentSpreads': FragmentRefs<'CommentsFragment'>\n}",signature:{properties:[{key:" $data",value:{name:"signature",type:"object",raw:"{\n  readonly __typename: string\n  readonly commentsCount: {\n    readonly total: number | null | undefined\n  }\n  readonly id: string\n  readonly isCommentsEnabled: boolean\n  readonly ' $fragmentSpreads': FragmentRefs<'CommentItem_target' | 'CommentsList_comments'>\n  readonly ' $fragmentType': 'CommentsFragment'\n}",signature:{properties:[{key:"__typename",value:{name:"string",required:!0}},{key:"commentsCount",value:{name:"signature",type:"object",raw:"{\n  readonly total: number | null | undefined\n}",signature:{properties:[{key:"total",value:{name:"union",raw:"number | null | undefined",elements:[{name:"number"},{name:"null"},{name:"undefined"}],required:!0}}]},required:!0}},{key:"id",value:{name:"string",required:!0}},{key:"isCommentsEnabled",value:{name:"boolean",required:!0}},{key:" $fragmentSpreads",value:{name:"FragmentRefs",elements:[{name:"union",raw:"'CommentItem_target' | 'CommentsList_comments'",elements:[{name:"literal",value:"'CommentItem_target'"},{name:"literal",value:"'CommentsList_comments'"}]}],raw:"FragmentRefs<'CommentItem_target' | 'CommentsList_comments'>",required:!0}},{key:" $fragmentType",value:{name:"literal",value:"'CommentsFragment'",required:!0}}]},required:!1}},{key:" $fragmentSpreads",value:{name:"FragmentRefs",elements:[{name:"literal",value:"'CommentsFragment'"}],raw:"FragmentRefs<'CommentsFragment'>",required:!0}}]}},description:""},profileId:{required:!1,tsType:{name:"string"},description:""},subscriptionsEnabled:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},CommentsList:{required:!1,tsType:{name:"FC",elements:[{name:"CommentsListProps"}],raw:"FC<CommentsListProps>"},description:"",defaultValue:{value:'({\n  target: targetRef,\n  profileId,\n  subscriptionsEnabled,\n  onReplyClick,\n  CommentItem = DefaultCommentItem,\n  CommentItemProps,\n  VirtuosoProps,\n}) => {\n  const { data: target, loadNext, isLoadingNext, hasNext } = useCommentList(targetRef)\n\n  const comments = useMemo(\n    () => target?.comments?.edges.filter((edge) => edge?.node).map((edge) => edge?.node) || [],\n    [target?.comments?.edges],\n  )\n\n  const renderCommentItem = (comment: any) => {\n    if (!comment) return null\n\n    return (\n      <CommentItem\n        target={target}\n        key={`comment-${comment.id}`}\n        comment={comment}\n        profileId={profileId}\n        currentThreadDepth={1}\n        subscriptionsEnabled={subscriptionsEnabled}\n        onReplyClick={onReplyClick}\n        {...CommentItemProps}\n      />\n    )\n  }\n\n  const renderHeader = () => {\n    if (comments.length === 0) return null\n\n    return <div className="h-2" />\n  }\n\n  const renderLoadingState = () => {\n    if (!isLoadingNext) return <Box sx={{ paddingTop: 3 }} />\n\n    return (\n      <LoadingState\n        sx={{ paddingTop: 3, paddingBottom: 1 }}\n        CircularProgressProps={{ size: 15 }}\n        aria-label="loading more comments"\n      />\n    )\n  }\n\n  return (\n    <>\n      {subscriptionsEnabled && <CommentsSubscription targetObjectId={target.id} />}\n      <div className="overflow-x-auto hide-scrollbar">\n        <Virtuoso\n          useWindowScroll\n          data={comments}\n          overscan={NUMBER_OF_COMMENTS_TO_LOAD_NEXT}\n          itemContent={(_index, comment) => renderCommentItem(comment)}\n          components={{\n            Header: renderHeader,\n            Footer: renderLoadingState,\n          }}\n          endReached={() => {\n            if (hasNext) {\n              loadNext(NUMBER_OF_COMMENTS_TO_LOAD_NEXT)\n            }\n          }}\n          {...VirtuosoProps}\n        />\n      </div>\n    </>\n  )\n}',computed:!1}},CommentsListProps:{required:!1,tsType:{name:"Partial",elements:[{name:"CommentsListProps"}],raw:"Partial<CommentsListProps>"},description:""},CommentCreate:{required:!1,tsType:{name:"FC",elements:[{name:"CommentCreateProps"}],raw:"FC<CommentCreateProps>"},description:"",defaultValue:{value:"forwardRef<HTMLInputElement, CommentCreateProps>(\n  (\n    {\n      targetObjectId,\n      placeholder = 'Comment...',\n      profileId,\n      autoFocusInput,\n      CommentTextFieldProps,\n      CommentTextField = DefaultCommentTextField,\n      CommentUpsertActions = DefaultCommentUpsertActions,\n      SendMessageIcon = DefaultSendMessageIcon,\n    },\n    ref,\n  ) => {\n    const commentReply = useCommentReply()\n    const isReply = !!commentReply.inReplyToId\n\n    const form = useForm<CommentCreateInput>({\n      defaultValues: DEFAULT_FORM_VALUES,\n      resolver: zodResolver(VALIDATION_SCHEMA),\n    })\n    const [commitMutation, isMutationInFlight] = useCommentCreateMutation()\n\n    const onSubmit = (data: CommentCreateInput) => {\n      if (isMutationInFlight) return null\n\n      nextClientMutationId += 1\n      const clientMutationId = nextClientMutationId.toString()\n\n      const connectionID = ConnectionHandler.getConnectionID(\n        commentReply.inReplyToId ?? targetObjectId,\n        'CommentsList_comments',\n      )\n\n      commitMutation({\n        variables: {\n          input: {\n            ...data,\n            targetObjectId,\n            inReplyToId: commentReply.inReplyToId,\n            profileId,\n            clientMutationId,\n          },\n          connections: [connectionID],\n        },\n        onCompleted: (response, errors) => {\n          if (errors) {\n            // TODO: handle errors\n            console.error(errors)\n            return\n          }\n          const mutationErrors = response?.commentCreate?.errors\n          setFormRelayErrors(form, mutationErrors)\n\n          if (!mutationErrors?.length) {\n            commentReply.resetCommentReply()\n            form.reset()\n            if (commentReply.commentItemRef?.current) {\n              commentReply.commentItemRef.current.scrollIntoView({\n                block: 'nearest',\n                inline: 'start',\n                behavior: 'smooth',\n              })\n            }\n          }\n        },\n        // TODO: handle errors\n        onError: console.error,\n      })\n\n      return null\n    }\n\n    const handleKeyDown: KeyboardEventHandler<HTMLDivElement> = (event) => {\n      if (event.key === 'Enter' && !event.shiftKey) {\n        event.preventDefault()\n        form.handleSubmit(onSubmit)(event)\n      }\n    }\n\n    const isCreateButtonDisabled = isMutationInFlight || !form.formState.isValid\n\n    return (\n      <form\n        id=\"comment-create\"\n        onSubmit={form.handleSubmit(onSubmit)}\n        className=\"sticky bottom-0 z-10 bg-common-white pb-4\"\n      >\n        <CommentTextField\n          inputRef={ref}\n          name={FORM_VALUE.body}\n          control={form.control}\n          onKeyDown={handleKeyDown}\n          placeholder={placeholder}\n          autoFocus={autoFocusInput}\n          isReply={isReply}\n          replyTargetName={commentReply.name}\n          onCancelReply={commentReply.resetCommentReply}\n          {...CommentTextFieldProps}\n        >\n          <CommentUpsertActions />\n          <IconButton\n            type=\"submit\"\n            form=\"comment-create\"\n            disabled={isCreateButtonDisabled}\n            aria-label=\"create comment\"\n          >\n            <SendMessageIcon />\n          </IconButton>\n        </CommentTextField>\n      </form>\n    )\n  },\n)",computed:!0}},CommentCreateProps:{required:!1,tsType:{name:"Partial",elements:[{name:"CommentCreateProps"}],raw:"Partial<CommentCreateProps>"},description:""},onCommentCreateFocus:{required:!1,tsType:{name:"signature",type:"function",raw:"(ref: HTMLInputElement) => void",signature:{arguments:[{type:{name:"HTMLInputElement"},name:"ref"}],return:{name:"void"}}},description:""}}};var CommentsWithQuery=function CommentsWithQuery(props){var data=(0,react_relay.useLazyLoadQuery)(void 0!==_CommentsWithQuery?_CommentsWithQuery:_CommentsWithQuery=__webpack_require__("./__generated__/CommentsWithQuery.graphql.ts"),{});return(0,jsx_runtime.jsx)(social_Comments,CommentsWithQuery_objectSpread(CommentsWithQuery_objectSpread({},props),{},{target:data.target}))};const _storybook_CommentsWithQuery=CommentsWithQuery;CommentsWithQuery.__docgenInfo={description:"",methods:[],displayName:"CommentsWithQuery",props:{target:{required:!0,tsType:{name:"signature",type:"object",raw:"{\n  readonly ' $data'?: CommentsFragment$data\n  readonly ' $fragmentSpreads': FragmentRefs<'CommentsFragment'>\n}",signature:{properties:[{key:" $data",value:{name:"signature",type:"object",raw:"{\n  readonly __typename: string\n  readonly commentsCount: {\n    readonly total: number | null | undefined\n  }\n  readonly id: string\n  readonly isCommentsEnabled: boolean\n  readonly ' $fragmentSpreads': FragmentRefs<'CommentItem_target' | 'CommentsList_comments'>\n  readonly ' $fragmentType': 'CommentsFragment'\n}",signature:{properties:[{key:"__typename",value:{name:"string",required:!0}},{key:"commentsCount",value:{name:"signature",type:"object",raw:"{\n  readonly total: number | null | undefined\n}",signature:{properties:[{key:"total",value:{name:"union",raw:"number | null | undefined",elements:[{name:"number"},{name:"null"},{name:"undefined"}],required:!0}}]},required:!0}},{key:"id",value:{name:"string",required:!0}},{key:"isCommentsEnabled",value:{name:"boolean",required:!0}},{key:" $fragmentSpreads",value:{name:"FragmentRefs",elements:[{name:"union",raw:"'CommentItem_target' | 'CommentsList_comments'",elements:[{name:"literal",value:"'CommentItem_target'"},{name:"literal",value:"'CommentsList_comments'"}]}],raw:"FragmentRefs<'CommentItem_target' | 'CommentsList_comments'>",required:!0}},{key:" $fragmentType",value:{name:"literal",value:"'CommentsFragment'",required:!0}}]},required:!1}},{key:" $fragmentSpreads",value:{name:"FragmentRefs",elements:[{name:"literal",value:"'CommentsFragment'"}],raw:"FragmentRefs<'CommentsFragment'>",required:!0}}]}},description:""},profileId:{required:!1,tsType:{name:"string"},description:""},subscriptionsEnabled:{required:!1,tsType:{name:"boolean"},description:""},CommentsList:{required:!1,tsType:{name:"FC",elements:[{name:"CommentsListProps"}],raw:"FC<CommentsListProps>"},description:""},CommentsListProps:{required:!1,tsType:{name:"Partial",elements:[{name:"CommentsListProps"}],raw:"Partial<CommentsListProps>"},description:""},CommentCreate:{required:!1,tsType:{name:"FC",elements:[{name:"CommentCreateProps"}],raw:"FC<CommentCreateProps>"},description:""},CommentCreateProps:{required:!1,tsType:{name:"Partial",elements:[{name:"CommentCreateProps"}],raw:"Partial<CommentCreateProps>"},description:""},onCommentCreateFocus:{required:!1,tsType:{name:"signature",type:"function",raw:"(ref: HTMLInputElement) => void",signature:{arguments:[{type:{name:"HTMLInputElement"},name:"ref"}],return:{name:"void"}}},description:""}}};const stories={title:"@baseapp-frontend | components/Social/Comments",component:_storybook_CommentsWithQuery,tags:["autodocs"],argTypes:{target:{description:"The key of the comments fragment.",control:!1,table:{type:{summary:"CommentsFragment$key"}}},profileId:{description:"ID of the profile.",control:!1,table:{type:{summary:"string"}}},subscriptionsEnabled:{description:"Whether subscriptions are enabled for real-time updates.",control:"boolean",table:{readonly:!0,type:{summary:"boolean"}}},CommentsList:{description:"Overrides the CommentsList component.",control:!1,table:{type:{summary:"FC<CommentsListProps>"}}},CommentsListProps:{description:"See CommentsList`s story for more details.",table:{type:{summary:"Partial<CommentsListProps>"}}},CommentCreate:{description:"Overrides the CommentCreate component.",control:!1,table:{type:{summary:"FC<CommentsListProps>"}}},CommentCreateProps:{description:"See CommentCreate`s story for more details.",table:{type:{summary:"Partial<CommentCreateProps>"}}},onCommentCreateFocus:{description:"Callback when the comment create input is focused.",control:!1,table:{type:{summary:"(ref: HTMLInputElement) => void"}}}}};var DefaultComments={name:"Default Comments",args:{subscriptionsEnabled:!1},parameters:{mockResolvers:{Node:function Node(){return{__typename:"CommentsInterface",id:"UGFnZTo0",isCommentsEnabled:!0,commentsCount:{total:5},comments:{edges:[{node:{__typename:"Comment",id:"comment-1",pk:1,body:"This is a pinned comment.",isPinned:!0,created:"2024-04-11T17:08:58.505961+00:00",commentsCount:{total:2},canChange:!0,canDelete:!0,canReport:!0,canPin:!0,user:{id:"user-1",pk:1,fullName:"John Doe",avatar:{url:"https://nyc3.digitaloceanspaces.com/baseapp-production-storage/media/user-avatars/5/6/4/resized/50/50/185a04dfdaa512d218cf9b7a5097e3c9.png"}},reactionsCount:{total:2},myReaction:null}},{node:{__typename:"Comment",id:"comment-2",pk:2,body:"This is a regular comment.",isPinned:!1,created:"2024-04-21T19:18:58.505961+00:00",commentsCount:{total:1},canChange:!1,canDelete:!1,canReport:!0,canPin:!1,user:{id:"user-2",pk:2,fullName:"Jane Smith",avatar:{url:"https://nyc3.digitaloceanspaces.com/baseapp-production-storage/media/user-avatars/c/9/19/resized/50/50/cb95449a94688af33f6e9bb090cf2936.png"}},reactionsCount:{total:3},myReaction:{id:"UmVhY3Rpb246MTA0",reactionType:"LIKE"}}}],pageInfo:{endCursor:"cursor-2",hasNextPage:!1}}}}}}}}}]);